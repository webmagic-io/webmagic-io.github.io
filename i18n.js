// i18n Language Configuration
const translations = {
    zh: {
        // Navigation
        nav: {
            features: "ç‰¹æ€§",
            quickstart: "å¿«é€Ÿå¼€å§‹",
            docs: "æ–‡æ¡£",
            github: "GitHub"
        },
        
        // Hero Section
        hero: {
            title: "çµæ´»çš„Javaçˆ¬è™«æ¡†æ¶",
            subtitle: "WebMagicæ˜¯ä¸€ä¸ªç®€å•çµæ´»çš„çˆ¬è™«æ¡†æ¶ï¼Œæ¶µç›–çˆ¬è™«çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼šä¸‹è½½ã€URLç®¡ç†ã€å†…å®¹æå–å’ŒæŒä¹…åŒ–",
            quickstart: "å¿«é€Ÿå¼€å§‹",
            viewSource: "æŸ¥çœ‹æºç "
        },
        
        // Features Section
        features: {
            title: "æ ¸å¿ƒç‰¹æ€§",
            simple: {
                title: "ç®€å•æ˜“ç”¨",
                desc: "æä¾›ç®€æ´çš„APIï¼Œå¿«é€Ÿä¸Šæ‰‹ï¼Œå‡ è¡Œä»£ç å³å¯æ„å»ºå¼ºå¤§çš„çˆ¬è™«ç¨‹åº"
            },
            flexible: {
                title: "é«˜åº¦çµæ´»",
                desc: "æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•ï¼Œæ”¯æŒè‡ªå®šä¹‰ä¸‹è½½å™¨ã€å¤„ç†å™¨å’Œç®¡é“"
            },
            multithread: {
                title: "å¤šçº¿ç¨‹æ”¯æŒ",
                desc: "å†…ç½®å¤šçº¿ç¨‹æ”¯æŒï¼Œæé«˜çˆ¬å–æ•ˆç‡ï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²"
            },
            annotation: {
                title: "æ³¨è§£é©±åŠ¨",
                desc: "æ”¯æŒæ³¨è§£æ–¹å¼é…ç½®POJOçˆ¬è™«ï¼Œè®©ä»£ç æ›´åŠ ç®€æ´ä¼˜é›…"
            },
            extraction: {
                title: "å¼ºå¤§æå–",
                desc: "æ”¯æŒXPathã€CSSé€‰æ‹©å™¨ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰å¤šç§å†…å®¹æå–æ–¹å¼"
            },
            integration: {
                title: "æ˜“äºé›†æˆ",
                desc: "æä¾›å¤šç§æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ"
            }
        },
        
        // Quick Start Section
        quickstart: {
            title: "å¿«é€Ÿå¼€å§‹",
            step1: "1. æ·»åŠ Mavenä¾èµ–",
            step2: "2. ç¼–å†™PageProcessor",
            step3: "3. å¯åŠ¨çˆ¬è™«"
        },
        
        // Docs Section
        docs: {
            title: "æ–‡æ¡£ä¸èµ„æº",
            chineseDocs: {
                title: "ğŸ“š ä¸­æ–‡æ–‡æ¡£",
                desc: "å®Œæ•´çš„ä¸­æ–‡ä½¿ç”¨æŒ‡å—å’ŒAPIæ–‡æ¡£",
                link: "æŸ¥çœ‹æ–‡æ¡£"
            },
            englishDocs: {
                title: "ğŸ“– English Docs",
                desc: "Complete English documentation and guides",
                link: "View Docs"
            },
            javadoc: {
                title: "ğŸ” JavaDoc",
                desc: "è¯¦ç»†çš„APIå‚è€ƒæ–‡æ¡£",
                link: "APIæ–‡æ¡£"
            },
            community: {
                title: "ğŸ’¬ ç¤¾åŒºæ”¯æŒ",
                desc: "GitHub Issues å’Œ QQç¾¤è®¨è®º",
                link: "æäº¤é—®é¢˜"
            }
        },
        
        // Footer
        footer: {
            description: "å¼€æºçš„Javaçˆ¬è™«æ¡†æ¶",
            project: "é¡¹ç›®",
            documentation: "æ–‡æ¡£",
            community: "ç¤¾åŒº",
            github: "GitHub",
            chineseDocs: "ä¸­æ–‡æ–‡æ¡£",
            english: "English",
            issues: "Issues",
            qqGroup: "QQç¾¤",
            copyright: "Â© 2024 WebMagic. Licensed under Apache 2.0"
        }
    },
    
    en: {
        // Navigation
        nav: {
            features: "Features",
            quickstart: "Quick Start",
            docs: "Docs",
            github: "GitHub"
        },
        
        // Hero Section
        hero: {
            title: "Flexible Java Web Crawler Framework",
            subtitle: "WebMagic is a scalable crawler framework that covers the whole lifecycle of crawler: downloading, url management, content extraction and persistent",
            quickstart: "Quick Start",
            viewSource: "View Source"
        },
        
        // Features Section
        features: {
            title: "Core Features",
            simple: {
                title: "Simple & Easy",
                desc: "Simple core with high flexibility. Build powerful crawlers with just a few lines of code"
            },
            flexible: {
                title: "Highly Flexible",
                desc: "Modular design for easy extension. Support custom downloaders, processors and pipelines"
            },
            multithread: {
                title: "Multi-thread Support",
                desc: "Built-in multi-threading support for better performance and distributed deployment"
            },
            annotation: {
                title: "Annotation Driven",
                desc: "Annotation-based POJO crawler configuration for cleaner and more elegant code"
            },
            extraction: {
                title: "Powerful Extraction",
                desc: "Support XPath, CSS selectors, regex and more for content extraction"
            },
            integration: {
                title: "Easy Integration",
                desc: "multiple data persistence solutions"
            }
        },
        
        // Quick Start Section
        quickstart: {
            title: "Quick Start",
            step1: "1. Add Maven Dependency",
            step2: "2. Write PageProcessor",
            step3: "3. Start Spider"
        },
        
        // Docs Section
        docs: {
            title: "Documentation & Resources",
            chineseDocs: {
                title: "ğŸ“š ä¸­æ–‡æ–‡æ¡£",
                desc: "Complete Chinese documentation and API reference",
                link: "View Docs"
            },
            englishDocs: {
                title: "ğŸ“– English Docs",
                desc: "Complete English documentation and guides",
                link: "View Docs"
            },
            javadoc: {
                title: "ğŸ” JavaDoc",
                desc: "Detailed API reference documentation",
                link: "API Docs"
            },
            community: {
                title: "ğŸ’¬ Community Support",
                desc: "GitHub Issues and community discussions",
                link: "Submit Issues"
            }
        },
        
        // Footer
        footer: {
            description: "Open source Java web crawler framework",
            project: "Project",
            documentation: "Documentation",
            community: "Community",
            github: "GitHub",
            chineseDocs: "Chinese Docs",
            english: "English",
            issues: "Issues",
            qqGroup: "QQ Group",
            copyright: "Â© 2024 WebMagic. Licensed under Apache 2.0"
        }
    }
};

// Logger Class
class Logger {
    constructor() {
        this.logs = [];
        this.maxLogs = 1000;
        this.logLevels = {
            ERROR: 0,
            WARN: 1,
            INFO: 2,
            DEBUG: 3
        };
        this.currentLevel = this.logLevels.INFO;
    }
    
    log(level, message, data = null) {
        if (this.logLevels[level] <= this.currentLevel) {
            const timestamp = new Date().toISOString();
            const logEntry = {
                timestamp,
                level,
                message,
                data,
                url: window.location.href,
                userAgent: navigator.userAgent
            };
            
            this.logs.push(logEntry);
            
            // Keep only the latest logs
            if (this.logs.length > this.maxLogs) {
                this.logs = this.logs.slice(-this.maxLogs);
            }
            
            // Console output
            const consoleMessage = `[${timestamp}] ${level}: ${message}`;
            switch(level) {
                case 'ERROR':
                    console.error(consoleMessage, data);
                    break;
                case 'WARN':
                    console.warn(consoleMessage, data);
                    break;
                case 'INFO':
                    console.info(consoleMessage, data);
                    break;
                case 'DEBUG':
                    console.debug(consoleMessage, data);
                    break;
                default:
                    console.log(consoleMessage, data);
            }
        }
    }
    
    error(message, data) { this.log('ERROR', message, data); }
    warn(message, data) { this.log('WARN', message, data); }
    info(message, data) { this.log('INFO', message, data); }
    debug(message, data) { this.log('DEBUG', message, data); }
    
    getLogs() { return this.logs; }
    
    exportLogs() {
        const logsJson = JSON.stringify(this.logs, null, 2);
        const blob = new Blob([logsJson], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `webmagic-logs-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    
    setLevel(level) {
        if (this.logLevels.hasOwnProperty(level)) {
            this.currentLevel = this.logLevels[level];
            this.info(`Log level set to ${level}`);
        }
    }
}

// i18n Class
class I18n {
    constructor() {
        this.currentLang = this.detectLanguage();
        this.translations = translations;
        this.logger = new Logger();
        this.logger.info('I18n system initialized', { language: this.currentLang });
    }
    
    detectLanguage() {
        // Check localStorage first
        const savedLang = localStorage.getItem('webmagic-lang');
        if (savedLang && ['zh', 'en'].includes(savedLang)) {
            return savedLang;
        }
        
        // Check browser language
        const browserLang = navigator.language || navigator.userLanguage;
        if (browserLang.startsWith('zh')) {
            return 'zh';
        }
        
        return 'en'; // Default to English
    }
    
    setLanguage(lang) {
        if (!this.translations[lang]) {
            this.logger.error(`Language ${lang} not supported`);
            return false;
        }
        
        this.currentLang = lang;
        localStorage.setItem('webmagic-lang', lang);
        this.logger.info(`Language changed to ${lang}`);
        this.updateDOM();
        return true;
    }
    
    getCurrentLanguage() {
        return this.currentLang;
    }
    
    t(key) {
        const keys = key.split('.');
        let value = this.translations[this.currentLang];
        
        for (const k of keys) {
            if (value && typeof value === 'object' && value.hasOwnProperty(k)) {
                value = value[k];
            } else {
                this.logger.warn(`Translation key not found: ${key}`);
                return key;
            }
        }
        
        return value || key;
    }
    
    updateDOM() {
        // Update all elements with data-i18n attribute
        const elements = document.querySelectorAll('[data-i18n]');
        elements.forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.t(key);
            
            if (element.tagName === 'INPUT' && element.type === 'text') {
                element.placeholder = translation;
            } else {
                element.textContent = translation;
            }
        });
        
        // Update HTML lang attribute
        document.documentElement.lang = this.currentLang === 'zh' ? 'zh-CN' : 'en';
        
        // Update page title and meta description
        document.title = this.currentLang === 'zh' 
            ? 'WebMagic - çµæ´»çš„Javaçˆ¬è™«æ¡†æ¶' 
            : 'WebMagic - Flexible Java Web Crawler Framework';
            
        // Update meta description
        const metaDesc = document.querySelector('meta[name="description"]');
        if (metaDesc) {
            metaDesc.content = this.currentLang === 'zh'
                ? 'WebMagicæ˜¯ä¸€ä¸ªç®€å•çµæ´»çš„Javaçˆ¬è™«æ¡†æ¶ï¼Œæ”¯æŒå¤šçº¿ç¨‹ã€åˆ†å¸ƒå¼çˆ¬è™«ï¼Œæä¾›ç®€æ´çš„APIå’Œå¼ºå¤§çš„æ‰©å±•èƒ½åŠ›'
                : 'WebMagic is a scalable Java web crawler framework with simple core, high flexibility, multi-threading support and easy integration capabilities';
        }
            
        // Update language toggle button
        const langToggle = document.querySelector('.lang-toggle');
        if (langToggle) {
            langToggle.textContent = this.currentLang === 'zh' ? 'EN' : 'ä¸­æ–‡';
        }
        
        this.logger.info('DOM updated for language change', {
            newLanguage: this.currentLang,
            title: document.title
        });
    }
    
    getAvailableLanguages() {
        return Object.keys(this.translations);
    }
}

// Global instances
const logger = new Logger();
const i18n = new I18n();

// Export for use in other scripts
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { I18n, Logger, i18n, logger };
} else {
    window.i18n = i18n;
    window.logger = logger;
}